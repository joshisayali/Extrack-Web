"use strict";angular.module("extrackWebApp",["ngResource","ui.router","ngDialog"]).config(["$stateProvider","$urlRouterProvider",function(a,b){a.state("app",{url:"/",views:{header:{templateUrl:"views/header.html",controller:"HeaderController"},content:{templateUrl:"views/home.html",controller:"HomeController"},footer:{templateUrl:"views/footer.html"}}}).state("app.expense",{url:"expense",views:{"content@":{templateUrl:"views/expense.html",controller:"ExpenseController"}}}),b.otherwise("/")}]),angular.module("extrackWebApp").controller("ExpenseController",["$scope","$state","expenseFactory","authFactory","ngDialog",function(a,b,c,d,e){a.message="Loading...",a.editMode=!1,a.newExpense={expenseDate:"",expenseItem:"",expenseAmount:"",expensePayment:"",expenseSubCategory:"",expenseRepeat:""},a.filterData={fromDate:"",toDate:""},a.showError=!1,a.customErrorMessage="Error Occured. Please try again. Error Details:",a.isFilter=!1,a.expenses=c.getUserExpenses().query({username:d.getUsername()}).$promise.then(function(b){a.expenses=b,a.showError=!1},function(b){console.log(d.getUsername()),console.log(b),a.showError=!0,a.message=a.customErrorMessage+b.data.message}),a.expenseCategories=c.getExpenseCategories().query(function(b){a.expenseCategories=b},function(a){console.log("Error: "+a)}),a.expenseSubCategories=c.getExpenseSubCategories().query(function(b){a.expenseSubCategories=b},function(a){console.log("Error: "+a)}),a.expensePayments=c.getExpensePayments().query(function(b){a.expensePayments=b},function(a){console.log("Error: "+a)}),a.expenseRepeats=c.getExpenseRepeats().query(function(b){a.expenseRepeats=b},function(a){console.log("Error: "+a)}),a.openCreateExpense=function(){e.open({template:"views/createExpense.html",scope:a,className:"ngdialog-theme-default",controller:"RegisterController"})},a.createExpense=function(){a.newExpense.username=d.getUsername(),c.getUserExpenses().create({username:d.getUsername()},a.newExpense).$promise.then(function(c){console.log(c),e.close(),a.showError=!1,b.go(b.current,{},{reload:!0})},function(b){console.log(b),e.close(),a.showError=!0,a.message=a.customErrorMessage+b.data.message}),a.newExpense={expenseDate:"",expenseItem:"",expenseAmount:"",expensePayment:"",expenseSubCategory:"",expenseRepeat:""},a.createExpenseForm.$setPristine()},a.filterExpenses=function(){var b=Date.parse(a.filterData.fromDate),e=Date.parse(a.filterData.toDate);console.log("Expense controller:"+b+","+e),a.expenses=c.getSpecificExpenses().query({username:d.getUsername(),from:b,to:e},function(b){a.expenses=b,a.showError=!1,a.isFilter=!0},function(b){console.log("Error: "+b),a.showError=!0,a.message=a.customErrorMessage+b.data.message}),a.filterData={fromDate:"",toDate:""},a.filterForm.$setPristine()},a.saveExpense=function(e){a.expense=e,console.log("Save Expense"),c.getUserExpenses().update({username:d.getUsername(),expenseId:a.expense._id},a.expense).$promise.then(function(c){console.log(c),a.showError=!1,b.go(b.current,{},{reload:!0})},function(b){console.log(b),a.showError=!0,a.message=a.customErrorMessage+b.data.message}),a.toggleEditMode()},a.deleteExpense=function(e){c.getUserExpenses()["delete"]({username:d.getUsername(),expenseId:e}).$promise.then(function(c){console.log(c),a.showError=!1,b.go(b.current,{},{reload:!0})},function(b){console.log(b),a.showError=!0,a.message=a.customErrorMessage+b.data.message})},a.toggleEditMode=function(b){a.editMode=!a.editMode,a.editModeId=b},a.getTotal=function(){for(var b=0,c=0;c<a.expenses.length;c++)b+=a.expenses[c].expenseAmount;return b}}]),angular.module("extrackWebApp").controller("HomeController",["$scope","ngDialog",function(a,b){a.bgImage="../images/free-finance-books-760x463.46831084.jpg",a.openRegister=function(){b.open({template:"views/register.html",scope:a,className:"ngdialog-theme-default",controller:"RegisterController"})}}]),angular.module("extrackWebApp").controller("HeaderController",["$scope","$state","$rootScope","ngDialog","authFactory",function(a,b,c,d,e){a.loggedIn=!1,a.username="",e.isAuthenticated()&&(a.loggedIn=!0,a.username=e.getUsername()),a.openLogin=function(){d.open({template:"views/login.html",scope:a,className:"ngdialog-theme-default",controller:"LoginController"})},a.logOut=function(){e.logout(),a.loggedIn=!1,a.username=""},c.$on("login:Successful",function(){a.loggedIn=e.isAuthenticated(),a.username=e.getUsername()}),c.$on("registration:Successful",function(){a.loggedIn=e.isAuthenticated(),a.username=e.getUsername()}),a.stateis=function(a){return b.is(a)}}]),angular.module("extrackWebApp").controller("LoginController",["$scope","ngDialog","$localStorage","authFactory",function(a,b,c,d){a.loginData=c.getObject("userinfo","{}"),a.doLogin=function(){a.rememberMe&&c.storeObject("userinfo",a.loginData),d.login(a.loginData),b.close()},a.openRegister=function(){b.open({template:"views/register.html",scope:a,className:"ngdialog-theme-default",controller:"RegisterController"})}}]),angular.module("extrackWebApp").controller("RegisterController",["$scope","ngDialog","$localStorage","authFactory",function(a,b,c,d){a.register={},a.loginData={},a.doRegister=function(){console.log("Doing registration",a.registration),d.register(a.registration),b.close()}}]),angular.module("extrackWebApp").constant("baseURL","https://dry-spire-60543.herokuapp.com/").service("expenseFactory",["$resource","baseURL",function(a,b){this.getExpenses=function(){return a(b+"expenses/:id",null,{create:{method:"POST"},update:{method:"PUT"},"delete":{method:"DELETE"}})},this.getUserExpenses=function(){return a(b+"expenses/users/:username/:expenseId",null,{create:{method:"POST"},update:{method:"PUT"},"delete":{method:"DELETE"}})},this.getSpecificExpenses=function(){return a(b+"expenses/users/:username/:from-:to")},this.getExpenseCategories=function(){return a(b+"expensecategories")},this.getExpenseSubCategories=function(){return a(b+"expensesubcategories")},this.getExpensePayments=function(){return a(b+"expensepayments")},this.getExpenseRepeats=function(){return a(b+"expenserepeats")}}]),angular.module("extrackWebApp").service("authFactory",["$resource","$http","$localStorage","$rootScope","$window","baseURL","ngDialog",function(a,b,c,d,e,f,g){function h(){var a=c.getObject(l,"{}");void 0!=a.username&&j(a)}function i(a){c.storeObject(l,a),j(a)}function j(a){m=!0,n=a.username,o=a.token,b.defaults.headers.common["x-access-token"]=o}function k(){o=void 0,n="",m=!1,b.defaults.headers.common["x-access-token"]=o,c.remove(l)}var l="Token",m=!1,n="",o=void 0,p=this;this.login=function(b){a(f+"users/login").save(b,function(a){i({username:b.username,token:a.token}),d.$broadcast("login:Successful")},function(a){m=!1;var b='                <div class="ngdialog-message">                <div><h3>Login Unsuccessful</h3></div><div><p>'+a.data.err.message+"</p><p>"+a.data.err.name+'</p></div><div class="ngdialog-buttons">                    <button type="button" class="ngdialog-button ngdialog-button-primary" ng-click=confirm("OK")>OK</button>                </div>';g.openConfirm({template:b,plain:"true"})})},this.logout=function(){a(f+"users/logout").get(function(a){}),k()},this.register=function(b){a(f+"users/register").save(b,function(a){p.login({username:b.username,password:b.password}),b.rememberMe&&c.storeObject("userinfo",{username:b.username,password:b.password}),d.$broadcast("registration:Successful")},function(a){console.log(a.data.err);var b='                <div class="ngdialog-message">                <div><h3>Registration Unsuccessful</h3></div><div><p>'+a.data.err.message+"</p><p>"+a.data.err.name+"</p></div>";g.openConfirm({template:b,plain:"true"})})},this.isAuthenticated=function(){return m},this.getUsername=function(){return n},h()}]),angular.module("extrackWebApp").service("$localStorage",["$window",function(a){return{store:function(b,c){a.localStorage[b]=c},get:function(b,c){return a.localStorage[b]||c},remove:function(b){a.localStorage.removeItem(b)},storeObject:function(b,c){a.localStorage[b]=JSON.stringify(c)},getObject:function(b,c){return JSON.parse(a.localStorage[b]||c)}}}]),angular.module("extrackWebApp").run(["$templateCache",function(a){a.put("views/createExpense.html",'<div class="ngdialog-message"> <div class=""> <h4>Add New Expense</h4> </div> <div class=""> <form class="form-horizontal" role="form" name="createExpenseForm" ng-submit="createExpense()" novalidate> <div class="form-group"> <div class="col-sm-2"> <label for="expenseDate" class="control-label">When?</label> </div> <div class="col-sm-10"> <input ng-model="newExpense.expenseDate" type="date" class="form-control" id="expenseDate" placeholder="mm/dd/yyyy" required> </div> </div> <div class="form-group"> <div class="col-sm-2"> <label for="expenseItem" class="control-label">What?</label> </div> <div class="col-sm-10"> <input ng-model="newExpense.expenseItem" type="text" class="form-control" id="expenseItem" required> </div> </div> <div class="form-group"> <div class="col-sm-2"> <label for="expenseAmount" class="control-label">HowMuch?</label> </div> <div class="col-sm-10"> <input ng-model="newExpense.expenseAmount" type="text" class="form-control" id="expenseAmount" required> </div> </div> <div class="form-group"> <div class="col-sm-2"> <label for="expensePayment" class="control-label">How?</label> </div> <div class="col-sm-10"> <select ng-model="newExpense.expensePayment" class="form-control" id="expensePayment" ng-options="payment._id as payment.expensePaymentMode for payment in expensePayments"> <option value="">Select</option> </select> </div> </div> <div class="form-group"> <div class="col-sm-2"> <label for="expenseCategory" class="control-label">Category</label> </div> <div class="col-sm-10"> <select ng-model="newExpense.expenseSubCategory" class="form-control" id="expenseCategory" ng-options="subcategory._id as subcategory.expenseSubCategoryName for subcategory in expenseSubCategories"> <option value="">Select</option> </select> </div> </div> <div class="form-group"> <div class="col-sm-2"> <label for="expenseRepeat" class="control-label">Repeat</label> </div> <div class="col-sm-10"> <select ng-model="newExpense.expenseRepeat" class="form-control" id="expenseRepeat" ng-options="repeat._id as repeat.expenseRepeatFrequency for repeat in expenseRepeats"> <option value="">Select</option> </select> </div> </div> <div class="form-group"> <div class="col-sm-offset-2 col-sm-10"> <button type="submit" class="btn btn-info">Add</button> </div> </div> </form> </div> </div>'),a.put("views/expense.html",'<div ng-controller="ExpenseController"> <div class="section section-warning"> <div class="container"> <div class="row"> <div class="col-md-12"> <div class="page-header"> <h1>Expense <font color="#777777"> <span style="font-size: 23.4px; line-height: 23.4px">Your Expenses</span> </font> </h1> </div> </div> </div> </div> </div> <div class="modal fade" id="createExpenseModal"> <div class="modal-dialog"> <div class="modal-content"> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button> <h4 class="modal-title">Add New Expense</h4> </div> <div class="modal-body"> <form class="form-horizontal" role="form" name="createExpenseForm" ng-submit="createExpense()"> <div class="form-group"> <div class="col-sm-2"> <label for="expenseDate" class="control-label">When?</label> </div> <div class="col-sm-10"> <input ng-model="newExpense.expenseDate" type="date" class="form-control" id="expenseDate" placeholder="mm/dd/yyyy"> </div> </div> <div class="form-group"> <div class="col-sm-2"> <label for="expenseItem" class="control-label">What?</label> </div> <div class="col-sm-10"> <input ng-model="newExpense.expenseItem" type="text" class="form-control" id="expenseItem"> </div> </div> <div class="form-group"> <div class="col-sm-2"> <label for="expenseAmount" class="control-label">HowMuch?</label> </div> <div class="col-sm-10"> <input ng-model="newExpense.expenseAmount" type="text" class="form-control" id="expenseAmount"> </div> </div> <div class="form-group"> <div class="col-sm-2"> <label for="expensePayment" class="control-label">How?</label> </div> <div class="col-sm-10"> <select ng-model="newExpense.expensePayment" class="form-control" id="expensePayment" ng-options="payment._id as payment.expensePaymentMode for payment in expensePayments"> <option value="">Select</option> </select> </div> </div> <div class="form-group"> <div class="col-sm-2"> <label for="expenseCategory" class="control-label">Category</label> </div> <div class="col-sm-10"> <select ng-model="newExpense.expenseSubCategory" class="form-control" id="expenseCategory" ng-options="subcategory._id as subcategory.expenseSubCategoryName for subcategory in expenseSubCategories"> <option value="">Select</option> </select> </div> </div> <div class="form-group"> <div class="col-sm-2"> <label for="expenseRepeat" class="control-label">Repeat</label> </div> <div class="col-sm-10"> <select ng-model="newExpense.expenseRepeat" class="form-control" id="expenseRepeat" ng-options="repeat._id as repeat.expenseRepeatFrequency for repeat in expenseRepeats"> <option value="">Select</option> </select> </div> </div> <div class="form-group"> <div class="col-sm-offset-2 col-sm-10"> <button type="submit" class="btn btn-info">Add</button> </div> </div> </form> </div> </div> </div> </div> <div class="section"> <div class="container"> <div class="row text-danger" ng-if="showError">{{message}}</div> <div class="row"> <div class="col-md-2"> <div class="row"> <div class="col-md-12"> <!--<a class="btn btn-info" data-toggle="modal" data-target="#createExpenseModal" id="createExpense">Create New Expense</a>--> <a class="btn btn-info" ng-click="openCreateExpense()" id="createExpense">Create New Expense</a> </div> </div> <hr> <div class="row"> <div class="col-md-12"> <form role="form" name="filterForm" ng-submit="filterExpenses()"> <div class="form-group"> <label class="control-label" for="fromDate">From Date</label> <input class="form-control" id="fromDate" placeholder="mm/dd/yyyy" type="date" ng-model="filterData.fromDate"> </div> <div class="form-group"> <label class="control-label" for="toDate">To Date</label> <input class="form-control" id="toDate" placeholder="mm/dd/yyyy" type="date" ng-model="filterData.toDate"> </div> <div class="form-group"> <button type="submit" class="btn btn-info">Filter</button> <a ui-sref="app.expense" ui-sref-opts="{reload:true}" class="btn btn-info" ng-if="isFilter">Show All</a> </div> </form> </div> </div> </div> <div class="col-md-10"> <table class="table"> <thead> <tr> <th class="info">When?</th> <th class="info">What?</th> <th class="info">How Much?</th> <th class="info">How?</th> <th class="info">Category</th> <th class="info">Repeat</th> <th class="info"></th> </tr> </thead> <tbody> <tr ng-repeat="expense in expenses" ng-show="expense._id == editModeId"> <td> <input type="date" class="form-control" id="editexpenseDate" name="editexpenseDate" ng-model="expense.expenseDate"> </td> <td> <input type="text" class="form-control" id="editexpenseItem" name="editexpenseItem" ng-model="expense.expenseItem"> </td> <td> <input type="text" class="form-control" id="editexpenseAmount" name="editexpenseAmount" ng-model="expense.expenseAmount"> </td> <td> <select class="form-control" id="editexpensePayment" name="editexpensePayment" ng-model="expense.expensePayment" ng-options="payment._id as payment.expensePaymentMode for payment in expensePayments"> <option value="">Select</option> </select> </td> <td> <select class="form-control" id="editexpenseSubCategory" name="editexpenseSubCategory" ng-model="expense.expenseSubCategory" ng-options="subcategory._id as subcategory.expenseSubCategoryName for subcategory in expenseSubCategories"> <option value="">Select</option> </select> </td> <td> <select class="form-control" id="editexpenseRepeat" name="editexpenseRepeat" ng-model="expense.expenseRepeat" ng-options="repeat._id as repeat.expenseRepeatFrequency for repeat in expenseRepeats"> <option value="">Select</option> </select> </td> <td> <button class="btn btn-default-noborder" ng-click="saveExpense(expense)"><span class="glyphicon glyphicon-check text-success"></span></button> <a ng-click="toggleEditMode()"><span class="glyphicon glyphicon-remove-sign text-danger"></span></a> </td> </tr> <tr ng-repeat="expense in expenses" ng-hide="expense._id == editModeId"> <td>{{expense.expenseDate | date : \'MM/dd/yyyy\'}}</td> <td>{{expense.expenseItem}}</td> <td>{{expense.expenseAmount}}</td> <td>{{expense.expensePayment.expensePaymentMode}}</td> <td>{{expense.expenseSubCategory.expenseSubCategoryName}}</td> <td>{{expense.expenseRepeat.expenseRepeatFrequency}}</td> <td> <a ng-click="toggleEditMode(expense._id)"><span class="glyphicon glyphicon-edit text-info"></span></a> <a ng-click="deleteExpense(expense._id)"><span class="glyphicon glyphicon-trash text-danger"></span></a> </td> </tr> </tbody> <tfoot> <tr> <td colspan="2"> <strong>Total</strong> </td> <td>{{getTotal()}}</td> <td></td> <td></td> <td></td> <td></td> </tr> </tfoot> </table> </div> </div> </div> </div> </div>'),a.put("views/footer.html",'<footer class="section section-warning"> <div class="container"> <div class="row"> <div class="col-sm-6"> <h1>Footer header</h1> <p>Lorem ipsum dolor sit amet, consectetur adipisici elit, <br>sed eiusmod tempor incidunt ut labore et dolore magna aliqua. <br>Ut enim ad minim veniam, quis nostrud</p> </div> <div class="col-sm-6"> <p class="text-info text-right"> <br> <br> </p> <div class="row"> <div class="col-md-12 hidden-lg hidden-md hidden-sm text-left"> <a href="#"><i class="fa fa-3x fa-fw fa-instagram text-inverse"></i></a> <a href="#"><i class="fa fa-3x fa-fw fa-twitter text-inverse"></i></a> <a href="#"><i class="fa fa-3x fa-fw fa-facebook text-inverse"></i></a> <a href="#"><i class="fa fa-3x fa-fw fa-github text-inverse"></i></a> </div> </div> <div class="row"> <div class="col-md-12 hidden-xs text-right"> <a href="#"><i class="fa fa-3x fa-fw fa-instagram text-inverse"></i></a> <a href="#"><i class="fa fa-3x fa-fw fa-twitter text-inverse"></i></a> <a href="#"><i class="fa fa-3x fa-fw fa-facebook text-inverse"></i></a> <a href="#"><i class="fa fa-3x fa-fw fa-github text-inverse"></i></a> </div> </div> </div> </div> </div> </footer>'),a.put("views/header.html",'<div class="navbar navbar-default navbar-inverse navbar-static-top background-colorred mystyles"> <div class="container"> <div class="navbar-header"> <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-ex-collapse"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" ui-sref="app"><span>Extrack</span></a> </div> <div class="collapse navbar-collapse" id="navbar-ex-collapse"> <ul class="nav navbar-left navbar-nav mystyles"> <li class="active mystyles"> <a ui-sref="app.expense">Expense</a> </li> <li> <a ui-sref="app.expense">Income</a> </li> <li> <a ui-sref="app.expense">Accounts</a> </li> <li> <a ui-sref="app.expense">Budget</a> </li> <li> <a ui-sref="app.expense">Analysis</a> </li> </ul> <ul class="nav navbar-nav navbar-right"> <li ng-if="!loggedIn"> <a ng-click="openLogin()"><span class="glyphicon glyphicon-log-in"></span> Login</a> </li> <li ng-if="loggedIn"> <a>{{username}}</a> </li> <li ng-if="loggedIn"> <a ng-click="logOut()"> <span class="glyphicon glyphicon-log-in"></span> Logout</a> </li> </ul> </div> </div> </div>'),a.put("views/home.html",'<div class="section" ng-controller="HomeController" style="background-image: url({{ bgImage }});background-position: center;width: 100%;\r\n  height: 100%; background-size: cover"> <div class="container"> <div class="row"> <div class="col-md-12 text-center"> <h1 class="text-muted" style="font-size:100px">Extrack</h1> <p class="lead text-warning" style="font-size:40px; color:black"> <b>An easy expense tracker. Manage your personal expenses effortlessly.</b> </p> <b> <br> <br> <a class="btn btn-lg btn-primary" ng-click="openRegister()">Register to Start Using Today!</a> </b> </div> <b></b> </div> <b></b> </div> <b></b> </div>'),a.put("views/login.html",'<div class="ngdialog-message"> <div class=""> <h3>Login </h3> </div> <div class="">&nbsp;</div> <div class=""> <form ng-submit="doLogin()"> <div class="form-group"> <label class="sr-only" for="username">Username</label> <input type="text" class="form-control input-sm" id="username" placeholder="Username" ng-model="loginData.username"> </div> <div class="form-group"> <label class="sr-only" for="password">Password</label> <input type="password" class="form-control input-sm" id="password" placeholder="Password" ng-model="loginData.password"> </div> <div class="checkbox"> <label> <input type="checkbox" ng-model="rememberMe"> Remember me </label> </div> <button type="submit" class="btn btn-info btn-sm">Sign in</button> <button type="button" class="btn btn-default btn-sm" ng-click="closeThisDialog(&quot;Cancel&quot;)">Cancel</button> &nbsp; &nbsp; <a ng-click="openRegister()">Click here to register</a> </form> </div> </div>'),a.put("views/register.html",'<div class="ngdialog-message"> <div class=""> <h3>Register </h3> </div> <div class="">&nbsp;</div> <div class=""> <form ng-submit="doRegister()"> <div class="form-group"> <label class="sr-only" for="username">Username</label> <input type="text" class="form-control input-sm" id="username" placeholder="Username" ng-model="registration.username"> </div> <div class="form-group"> <label class="sr-only" for="password">Password</label> <input type="password" class="form-control input-sm" id="password" placeholder="Password" ng-model="registration.password"> </div> <div class="form-group"> <label class="sr-only" for="firstname">First Name</label> <input type="text" class="form-control input-sm" id="firstname" placeholder="First Name" ng-model="registration.firstname"> </div> <div class="form-group"> <label class="sr-only" for="lastname">Last Name</label> <input type="text" class="form-control input-sm" id="lastname" placeholder="Last Name" ng-model="registration.lastname"> </div> <div class="checkbox"> <label> <input type="checkbox" ng-model="registration.rememberMe"> Remember me </label> </div> <button type="submit" class="btn btn-info btn-sm">Register</button> <button type="button" class="btn btn-default btn-sm" ng-click="closeThisDialog(&quot;Cancel&quot;)">Cancel</button> </form> </div> </div>')}]);